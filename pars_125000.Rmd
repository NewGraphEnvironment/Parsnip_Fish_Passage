---
title: "habitat_confirmation"
author: "Al Irvine"
date: "April 5, 2020"
output: html_document
---

```{r setup, include = TRUE, results='hide', echo =FALSE, message=FALSE, warning=FALSE}
knitr::opts_chunk$set(echo=FALSE, results='hide', message=FALSE, warning=FALSE, 
                      fig.align="center", fig.width = 5.118, fig.height = 3.409,
                      fig.path = ('fig/'))

```


```{r}
##bring in the data
#we are using drake now and source("make.R") to set up our environment
drake::loadd(c(fish_data, site_data, loc_data, tracks, track_points))
```

```{r}
my_site <- '125000'


##doll up the gpx data
##here are the indexes of the points
track_point_idx_list <- sf::st_intersects(tracks, track_points) %>% 
  purrr::set_names(., nm = pull(tracks, name))

tracks_of_points <- lapply(track_point_idx_list, 
                           make_tracks_of_points, track_points = track_points)


my_tracks <- tracks_of_points %>% 
  keep(names(.) %like% my_site) %>% 
  map(points2line_trajectory)  ##convert our points to lines

# addPolylines_multi <- function(x){
#     addPolylines(data=x,  opacity=1, color = 'red',
#                    fillOpacity = 0.75, weight=2)
# }

#clean up workspace
rm(track_point_idx_list, track_points, tracks)
```

Get some basic information about our stream and watershed.

```{r }
##--------lets map it-----------------------------------------------------------------------
##this refuses to render through drake... Maybe we need to make it a function or put it in another 
##script and point to it...
##some info on hml widgets here https://data.nozav.org/post/2019-a-short-introduction-to-drake/
map <- leaflet() %>%
  addTiles() %>%
  addProviderTiles("Esri.WorldImagery", group = "ESRI Aerial") %>% 
  addProviderTiles("Esri.WorldTopoMap", group = "Topo") %>%
  addPolylines(data=my_tracks$`125000_ds_track`,  opacity=1, color = 'red',
                   fillOpacity = 0.75, weight=2) %>%
  addPolylines(data=my_tracks$`125000_us_track1`,  opacity=1, color = 'blue',
               fillOpacity = 0.75, weight=2) %>%
  addLayersControl(
    baseGroups = c("Topo","ESRI Aerial"),
    overlayGroups = c(my_tracks$`125000_ds_track`),
    options = layersControlOptions(collapsed = T))
map
```
